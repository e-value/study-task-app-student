# Lesson4: Serviceは本当に便利か？〜振り返りと違和感を言語化する〜

## 🎯 この Lesson の目的

この Lesson4 では **新しい実装は行いません。**

これまでの Lesson を振り返りながら、以下を整理します：

1. **Lesson2 と Lesson3 の比較** - Service に切り分けたことで何が変わったか
2. **良くなった点の言語化** - Controller がスリムになった以外に何があるか
3. **違和感・改善点の発見** - Service 設計の課題を見つける
4. **次のリファクタリングへの準備** - 「全部 Service に入れる設計」の限界を理解する

---

## 📍 Lesson4 の位置づけ

これまでの流れを振り返ってみましょう。

```
Lesson1：まずは動かす（エンドポイント設計・Controller作成）
Lesson2：Controller に全部書いてみる（肥大化を体験）
Lesson3：Service / FormRequest に切り分ける（責務分離）
Lesson4：Service に切り分けた結果を疑う ← 今ここ
```

Lesson3 までで「Controller はスリムになった」と感じた人も多いはずです。

しかし本当にそれで設計は良くなったのでしょうか？

---

## 👀 まず最初にやること（重要）

### ① ブランチを見比べる

以下のブランチを **コードを書かずに眺めてください**。

-   `lesson2` または `lesson2_自分の名字`
-   `lesson3` または `lesson3_自分の名字`

📌 ポイント

**コードを正確に理解する必要はありません。**

次の点だけを意識してください：

-   Controller には何が残っているか
-   Service にはどんな処理が集まっているか
-   Service のメソッド名・private メソッド名は何を表しているか
-   どのファイルが読みやすいと感じるか

---

### ② Service を「冷静な目」で見る

Service を見て、次のような感情が出てきたら正解です：

-   「思ったより長いな…」
-   「この Service、何でもやってない？」
-   「この処理、どこに書くのが正解なんだろう？」
-   「private メソッドが増えすぎてないか？」

👉 **その違和感を大切にしてください。**

---

## 💡 このレッスンで体験すること

Lesson4 は **実装ではなく振り返り** が中心です。

以下の観点で、Lesson2 と Lesson3 を比較してください：

### 比較の観点

1. **コードの見通し**
    - どちらが読みやすいか？
    - どちらが変更しやすそうか？

2. **責務の明確さ**
    - Controller の役割は明確になったか？
    - Service の役割は明確か？

3. **再利用性**
    - 処理を別の場所で使い回せそうか？
    - テストは書きやすそうか？

4. **違和感**
    - Service が肥大化していないか？
    - 「どの Service に書くか」で迷う処理はないか？

---

## ✍️ この Lesson でやること（実装なし）

### ① 良くなった点を書き出す

以下の観点で **メモを取ってください**（箇条書きでOK）：

-   Controller がスリムになった具体的な効果
-   FormRequest で切り出したことによる恩恵
-   Service で切り出したことによる恩恵
-   private メソッドによる整理の効果

---

### ② 違和感・改善点を書き出す

以下の観点で **メモを取ってください**（箇条書きでOK）：

-   Service が肥大化していると感じた点
-   Service 同士が依存し始めている箇所
-   複数モデル（Project / Task / Membership）が絡んでいる処理
-   private メソッドが増えすぎて意味が追いづらい箇所
-   「この処理、どこに書くべき？」と迷った箇所

---

### ③ 自分なりの「疑問」を作る

正解を出す必要はありません。

例：

-   このルールは TaskService に書くべき？
-   ProjectMemberService に Task を触らせていいの？
-   Service に切り分けたけど、次はどこを分けるべき？
-   private メソッドはどこまで切り出すべき？

**「わからない」状態をそのまま言葉にすることが重要です。**

---

## 🧠 よく出てくる気づき（例）

多くの人が次のような点で悩み始めます：

-   Service が「第二の Controller」になっている
-   Service が万能クラスになりがち
-   「どの Service に書くか」で迷う処理が増える
-   Service に逃げただけで設計はまだ途中だと気づく
-   private メソッドが増えると、かえって追いづらくなる

この気づきこそが **Lesson4 の最大の成果** です。

---

## 📝 振り返りのポイント

### Lesson2（Controller に全部書く）の特徴

**メリット：**

-   すべてのコードが1ヶ所にある
-   処理の流れが追いやすい

**デメリット：**

-   Controller が肥大化
-   責務が不明確
-   テストしにくい
-   再利用できない

---

### Lesson3（Service に切り分ける）の特徴

**メリット：**

-   Controller がスリム
-   責務が分離される
-   テストしやすくなる
-   再利用しやすくなる

**デメリット？：**

-   Service が肥大化する可能性
-   「どの Service に書くか」で迷う
-   Service 同士の依存関係が生まれる
-   処理を追うために複数ファイルを見る必要がある

---

## 🎤 対面ディスカッションに向けて

Lesson4 の内容は、**このあと対面でディスカッションします。**

ディスカッションでは、

-   なぜその違和感を感じたのか
-   他のメンバーはどう感じたか
-   Service をさらに分けるとしたら、どう考えるか
-   どこまで切り分けるのが適切か

をテーマに話し合います。

**準備しておくこと：**

-   自分が感じた「良かった点」のメモ
-   自分が感じた「違和感」のメモ
-   「これはどうすべき？」という疑問のリスト

---

## 📘 この Lesson のまとめ

-   Lesson4 では **実装しない**
-   Lesson2 と Lesson3 を比較する
-   Service に切り分けた結果を冷静に振り返る
-   「Service = 正解」という思い込みを一度壊す
-   次のリファクタリングに向けた疑問を集める

**重要：**

> この Lesson の目的は「答えを出すこと」ではなく、
> **「良い設計とは何か？」を自分なりに考え始めること** です。
